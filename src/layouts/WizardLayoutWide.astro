---
import Block from "@components/block/Block.astro";
import BaseLayout from "@layouts/WizardBaseLayout.astro";
import HeroImage from "@components/hero/HeroImage.astro";
import HeroPlain from "@components/hero/HeroPlain.astro";

const props = Astro.props;
const { title, description, blocks, style, thumbnail, og_image } = Astro.props;
const contentClass = style.hero_template === "plain" ? "py-0" : "py-20";
const hasBlocks = blocks && blocks.length > 0;
---

<BaseLayout
  {title}
  {description}
  pageClass={style.page_class}
  {thumbnail}
  {og_image}
>
  {
    style.hero_template == "plain" && (
      <HeroPlain {...props}>
        <slot name="hero" />
      </HeroPlain>
    )
  }
  {
    style.hero_template == "image" && (
      <HeroImage {...props}>
        <slot name="hero" />
      </HeroImage>
    )
  }

  <div class="relative z-10 w-full" id="more">
    <div
      class=`page__content container-${style.container || 'md'} ${style.content_class || contentClass} `
    >
      <slot />
      {!hasBlocks && <slot name="nav" />}
    </div>

    {
      hasBlocks && (
        <>
          <div class={style.block_class}>
            {blocks.map((section) => (
              <Block {...section} />
            ))}
          </div>

          <slot name="nav" />
        </>
      )
    }
    <div class="pointer-events-none fixed bottom-0 z-40 w-full">
      <slot name="cart" />
    </div>
  </div>
</BaseLayout>

<style is:global>
  /*
    This stylesheet applies to every page that uses the WizardLayoutWide
    It ensures that any content inside of the <slot> or <Block> components
    that is empty (i.e. contains no RichText blocks) is hidden.
    This is useful for preventing empty sections from appearing on the page.

    The reason for this is that the RichText component will not render
    if it does not have any children, and we want to keep the layout
    of the page consistent.

    The styles also make sure that any images or iframes inside of the content
    are full-width on larger screens, and have a vertical margin of 10rem.
  */
  .page__content {
    &:empty {
      display: none;
    }
    &:has(> .richtext:empty) {
      display: none;
    }
    .img,
    iframe {
      width: calc(100% + var(--container-spacing));
      margin-left: calc(var(--spacing) * -1);
      @apply my-10 aspect-video h-auto;
      @screen md {
        width: 100%;
        margin-left: 0;
      }
    }
  }
</style>
